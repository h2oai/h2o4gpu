#!/usr/bin/groovy

@Library('test-shared-library@1.2') _

import ai.h2o.ci.Utils

pipeline {
    agent none

    // Setup job options
    options {
        ansiColor('xterm')
        timestamps()
        timeout(time: 300, unit: 'MINUTES')
        buildDiscarder(logRotator(numToKeepStr: '10'))
        disableConcurrentBuilds()
        skipDefaultCheckout()
    }
    stages {
        stage("Generate Docs") {
            agent {
                label "linux && docker && !micro"
            }
            steps {
                // Get source code
                deleteDir()
                checkout scm
                dumpInfo()
                script {
                    docker.withRegistry("https://docker.h2o.ai", "docker.h2o.ai") {
                        docker.image("docker.h2o.ai/r-3-5").inside {
                            sh """
                               cd src/interface_r &&
                               R3 -e 'pkgdown::build_site(examples=FALSE)'
                               """
                            archiveArtifacts artifacts: 'src/interface_r/docs/*.html'
                        }

                    }
                }
            }
        }
    }
}